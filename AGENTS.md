# AGENTS.md

<!-- Generated by Homer. Sections between homer:preserve markers are kept on update. -->

## Build & Test Commands

**github_actions:**
- `cargo fmt --all -- --check`
- `cargo clippy --workspace --all-targets -- -D warnings`
- `cargo build --workspace`
- `cargo test --workspace`
- `cargo build --workspace`
- `cargo test --workspace`
- `cargo install cross --git https://github.com/cross-rs/cross`
- `cargo build --release --target ${{ matrix.target }} -p homer-cli`
- `cross build --release --target ${{ matrix.target }} -p homer-cli`
- `|`

## Architecture Overview

The codebase organizes into 66 architectural clusters:

- **Cluster 0** (homer-cli/src/commands, 1 files): `homer-cli/src/commands/init.rs`
- **Cluster 1** (homer-cli/src/commands, 1 files): `homer-cli/src/commands/mod.rs`
- **Cluster 2** (homer-cli/src/commands, 1 files): `homer-cli/src/commands/status.rs`
- **Cluster 3** (homer-cli/src/commands, 1 files): `homer-cli/src/commands/update.rs`
- **Cluster 4** (homer-cli/src, 1 files): `homer-cli/src/main.rs`
- **Cluster 5** (homer-core/src/analyze, 1 files): `homer-core/src/analyze/behavioral.rs`
- **Cluster 6** (homer-core/src, 1 files): `homer-core/src/config.rs`
- **Cluster 7** (homer-core/src/store, 1 files): `homer-core/src/store/mod.rs`
- **Cluster 8** (homer-core/src, 1 files): `homer-core/src/types.rs`
- **Cluster 9** (homer-core/src/store, 1 files): `homer-core/src/store/sqlite.rs`
- **Cluster 10** (homer-core/src/analyze, 1 files): `homer-core/src/analyze/mod.rs`
- **Cluster 11** (homer-core/src/analyze, 1 files): `homer-core/src/analyze/traits.rs`
- **Cluster 12** (homer-core/src/extract, 1 files): `homer-core/src/extract/document.rs`
- **Cluster 13** (homer-core/src/extract, 2 files): `homer-core/src/extract/traits.rs`, `homer-core/src/error.rs`
- **Cluster 14** (homer-core/src/extract, 1 files): `homer-core/src/extract/git.rs`
- **Cluster 15** (homer-core/src/extract, 1 files): `homer-core/src/extract/graph.rs`
- **Cluster 16** (homer-core/src/extract, 1 files): `homer-core/src/extract/structure.rs`
- **Cluster 17** (homer-core/src/llm, 1 files): `homer-core/src/llm/mod.rs`
- **Cluster 18** (homer-core/src, 1 files): `homer-core/src/pipeline.rs`
- **Cluster 19** (homer-core/src/analyze, 1 files): `homer-core/src/analyze/centrality.rs`
- **Cluster 20** (homer-core/src/analyze, 1 files): `homer-core/src/analyze/community.rs`
- **Cluster 21** (homer-core/src/analyze, 1 files): `homer-core/src/analyze/convention.rs`
- **Cluster 22** (homer-core/src/analyze, 1 files): `homer-core/src/analyze/task_pattern.rs`
- **Cluster 23** (homer-core/src/analyze, 1 files): `homer-core/src/analyze/temporal.rs`
- **Cluster 24** (homer-core/src/extract, 1 files): `homer-core/src/extract/github.rs`
- **Cluster 25** (homer-core/src/extract, 1 files): `homer-core/src/extract/gitlab.rs`
- **Cluster 26** (homer-core/src/extract, 1 files): `homer-core/src/extract/prompt.rs`
- **Cluster 27** (homer-core/src, 1 files): `homer-core/src/progress.rs`
- **Cluster 28** (homer-core/src/render, 1 files): `homer-core/src/render/agents_md.rs`
- **Cluster 29** (homer-core/src/render, 1 files): `homer-core/src/render/module_context.rs`
- **Cluster 30** (homer-core/src/render, 1 files): `homer-core/src/render/report.rs`
- **Cluster 31** (homer-core/src/render, 1 files): `homer-core/src/render/risk_map.rs`
- **Cluster 32** (homer-core/src/render, 1 files): `homer-core/src/render/skills.rs`
- **Cluster 33** (homer-core/src/render, 1 files): `homer-core/src/render/topos_spec.rs`
- **Cluster 34** (homer-core/src/render, 1 files): `homer-core/src/render/traits.rs`
- **Cluster 35** (homer-core/src/store, 1 files): `homer-core/src/store/incremental.rs`
- **Cluster 36** (homer-core/src/store, 1 files): `homer-core/src/store/schema.rs`
- **Cluster 37** (homer-core/src/store, 1 files): `homer-core/src/store/traits.rs`
- **Cluster 38** (homer-graphs/src, 1 files): `homer-graphs/src/call_graph.rs`
- **Cluster 39** (homer-graphs/src, 1 files): `homer-graphs/src/scope_graph.rs`
- **Cluster 40** (homer-graphs/src, 1 files): `homer-graphs/src/diff.rs`
- **Cluster 41** (homer-graphs/src, 1 files): `homer-graphs/src/import_graph.rs`
- **Cluster 42** (homer-graphs/src/languages, 1 files): `homer-graphs/src/languages/fallback.rs`
- **Cluster 43** (homer-graphs/src/languages, 1 files): `homer-graphs/src/languages/go.rs`
- **Cluster 44** (homer-graphs/src/languages, 1 files): `homer-graphs/src/languages/java.rs`
- **Cluster 45** (homer-graphs/src/languages, 1 files): `homer-graphs/src/languages/javascript.rs`
- **Cluster 46** (homer-spec, 2 files): `homer-graphs/src/languages/mod.rs`, `homer-spec/ARCHITECTURE.md`
- **Cluster 47** (homer-graphs/src/languages, 1 files): `homer-graphs/src/languages/python.rs`
- **Cluster 48** (homer-graphs/src/languages, 1 files): `homer-graphs/src/languages/rust.rs`
- **Cluster 49** (homer-graphs/src/languages, 1 files): `homer-graphs/src/languages/typescript.rs`
- **Cluster 50** (homer-graphs/src, 1 files): `homer-graphs/src/lib.rs`
- **Cluster 51** (homer-mcp/src, 1 files): `homer-mcp/src/lib.rs`
- **Cluster 52** (homer-test/src, 1 files): `homer-test/src/lib.rs`
- **Cluster 53** (homer-graphs/src/languages, 1 files): `homer-graphs/src/languages/helpers.rs`
- **Cluster 54** (homer-test/tests, 1 files): `homer-test/tests/pipeline.rs`
- **Cluster 55** (homer-cli/src/commands, 1 files): `homer-cli/src/commands/graph.rs`
- **Cluster 56** (homer-cli/src/commands, 1 files): `homer-cli/src/commands/query.rs`
- **Cluster 57** (homer-core/src/llm, 1 files): `homer-core/src/llm/cache.rs`
- **Cluster 58** (homer-core/src/llm, 1 files): `homer-core/src/llm/providers.rs`
- **Cluster 59** (homer-cli/src/commands, 1 files): `homer-cli/src/commands/diff.rs`
- **Cluster 60** (homer-core/src/analyze, 1 files): `homer-core/src/analyze/semantic.rs`
- **Cluster 61** (homer-cli/src/commands, 1 files): `homer-cli/src/commands/serve.rs`
- **Cluster 62** (homer-core/benches, 1 files): `homer-core/benches/centrality_bench.rs`
- **Cluster 63** (homer-core/benches, 1 files): `homer-core/benches/parse_bench.rs`
- **Cluster 64** (homer-core/benches, 1 files): `homer-core/benches/store_bench.rs`
- **Cluster 65** (homer-graphs/src/languages, 1 files): `homer-graphs/src/languages/ecma_scope.rs`

## Module Map

| Module | Files | Functions | Types |
|--------|------:|----------:|------:|
| `homer` | 5 | 0 | 0 |
| `homer-cli` | 1 | 0 | 0 |
| `homer-cli/src` | 2 | 1 | 2 |
| `homer-cli/src/commands` | 8 | 32 | 19 |
| `homer-core` | 2 | 0 | 0 |
| `homer-core/benches` | 3 | 14 | 0 |
| `homer-core/src` | 12 | 66 | 64 |
| `homer-core/src/analyze` | 9 | 150 | 47 |
| `homer-core/src/extract` | 9 | 161 | 40 |
| `homer-core/src/llm` | 3 | 34 | 23 |
| `homer-core/src/query` | 1 | 0 | 0 |
| `homer-core/src/render` | 8 | 134 | 35 |
| `homer-core/src/store` | 5 | 64 | 10 |
| `homer-graphs` | 1 | 0 | 0 |
| `homer-graphs/src` | 6 | 37 | 40 |
| `homer-graphs/src/languages` | 10 | 264 | 25 |
| `homer-mcp` | 1 | 0 | 0 |
| `homer-mcp/src` | 1 | 17 | 5 |
| `homer-test` | 2 | 0 | 0 |
| `homer-test/src` | 1 | 8 | 1 |
| `homer-test/tests` | 1 | 13 | 0 |

## Key Documents

| Document | Type | References |
|----------|------|----------:|
| `README.md` | document | 11 |
| `docs/getting-started.md` | document | 4 |
| `docs/configuration.md` | document | 3 |
| `docs/troubleshooting.md` | document | 3 |
| `docs/concepts.md` | document | 2 |
| `CONTRIBUTING.md` | document | 1 |

## Change Patterns

**Most frequently changed files:**

| File | Changes |
|------|--------:|
| `homer-core` | 22 |
| `homer-core/src` | 21 |
| `homer-core/src/extract` | 16 |
| `homer-core/src/analyze` | 15 |
| `homer-cli/src/commands` | 12 |
| `homer-cli` | 12 |
| `homer-cli/src` | 12 |
| `homer-core/src/render` | 12 |
| `homer-core/src/pipeline.rs` | 11 |
| `homer-core/src/store` | 10 |

**Files that change together:**

- `homer-cli/src/commands` + `homer-core/src/render/traits.rs` (confidence: 1%)
- `homer-cli/src/commands` + `homer-core/src/analyze/.context.md` (confidence: 1%)
- `homer-cli/src/commands` + `homer-cli/src/commands/init.rs` (confidence: 1%)
- `homer-cli/src/commands/graph.rs` + `homer-core` (confidence: 1%)
- `homer-cli/src/commands/graph.rs` + `homer-cli` (confidence: 1%)

## Load-Bearing Code

Functions and types with the highest structural importance (composite salience).
Modifications require understanding all callers and running the full test suite.

| Entity | Salience | Classification |
|--------|----------|----------------|
| `homer-core/src/pipeline.rs` | 14.22 | ActiveLocalized |
| `homer-core/src/analyze/mod.rs` | 13.60 | ActiveLocalized |
| `homer-core/src/render/agents_md.rs` | 13.50 | ActiveLocalized |
| `homer-core/src/extract/graph.rs` | 13.33 | ActiveLocalized |
| `homer-core/src/analyze/behavioral.rs` | 13.20 | ActiveLocalized |
| `homer-core/src/store/sqlite.rs` | 12.89 | ActiveLocalized |
| `homer-core/src/config.rs` | 12.86 | ActiveLocalized |
| `homer-core/src/extract/git.rs` | 12.43 | ActiveLocalized |
| `homer-core/src/extract/structure.rs` | 12.28 | ActiveLocalized |
| `homer-core/src/analyze/community.rs` | 12.13 | ActiveLocalized |
| `homer-core/src/store/traits.rs` | 12.10 | ActiveLocalized |
| `homer-test/tests/pipeline.rs` | 12.06 | ActiveLocalized |
| `homer-core/src/extract/prompt.rs` | 11.83 | ActiveLocalized |
| `homer-graphs/src/languages/java.rs` | 11.82 | ActiveLocalized |
| `homer-graphs/src/languages/go.rs` | 11.52 | ActiveLocalized |
| `homer-graphs/src/languages/mod.rs` | 11.35 | ActiveLocalized |
| `homer-cli/src/commands/mod.rs` | 11.35 | ActiveLocalized |
| `homer-graphs/src/languages/typescript.rs` | 11.06 | ActiveLocalized |
| `homer-graphs/src/languages/python.rs` | 10.93 | ActiveLocalized |
| `homer-graphs/src/languages/rust.rs` | 10.78 | ActiveLocalized |

## Danger Zones

Files with high change frequency and low bus factor require extra care.

| File | Changes | Bus Factor | Top Contributor |
|------|--------:|-----------:|----------------:|
| `homer-core` | 22 | 1 | 95% |
| `homer-core/src` | 21 | 1 | 95% |
| `homer-core/src/extract` | 16 | 1 | 94% |
| `homer-core/src/analyze` | 15 | 1 | 93% |
| `homer-cli/src/commands` | 12 | 1 | 92% |
| `homer-cli` | 12 | 1 | 92% |
| `homer-cli/src` | 12 | 1 | 92% |
| `homer-core/src/render` | 12 | 1 | 92% |
| `homer-core/src/pipeline.rs` | 11 | 1 | 91% |
| `homer-core/src/store` | 10 | 1 | 90% |

## Conventions

**Languages:**
- rust: 71 files

**Dependencies:** 36 external packages

**Naming:** snake_case (66% adherence)
- snake_case: 866 (66%)
- lowercase: 234 (18%)
- PascalCase: 206 (16%)

**Testing:** unknown
- Pattern: tests/ directory
- 3 test files / 69 source files

**Error handling:** mixed
- `.unwrap()`: 999 occurrences
- `? operator`: 928 occurrences
- `Result<T, E>`: 286 occurrences
- `.expect()`: 21 occurrences

**Documentation:** 11% coverage (142/1306 entities)
- Dominant style: Rustdoc

**Agent rules:** CLAUDE.md

